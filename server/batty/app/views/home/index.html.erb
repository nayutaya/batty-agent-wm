
<%- if logged_in? -%>
  <%- additional_head { -%>
    <meta http-equiv="refresh" content="<%=h 5.minutes %>" />
  <%- } -%>
<%- end -%>

<%-
  if logged_in?
    @additional_head_html += rss_auto_discovery(:title => "バッテリ履歴", :href => url_for(:controller => "user_feeds", :action => "energies", :user_token => @login_user.user_token))
    @additional_head_html += rss_auto_discovery(:title => "イベント履歴", :href => url_for(:controller => "user_feeds", :action => "events", :user_token => @login_user.user_token))
  end
-%>

<%- additional_head { -%>
  <style type="text/css">
    table.list
    {
        border-collapse: collapse;
    }

    table.list thead tr th
    {
        padding: 0.4em;
        border-width: 1px;
        border-style: solid;
        border-color: #F0F0F0;
        color: #CCCCCC;
        background-color: #333333;
    }

    table.list tbody tr
    {
        border-width: 1px;
        border-style: solid;
        border-color: #F0F0F0;
    }

    table.list tbody tr td
    {
        padding: 0.2em 0.4em;
        border-width: 0;
    }

    table.list tbody tr.even td
    {
        background-color: #E0E0E0;
    }

    table.list tbody tr.odd td
    {
        background-color: #D0D0D0;
    }

    table.list tfoot td
    {
        text-align: right;
    }
  </style>
<%- } -%>

<%- unless logged_in? -%>
  <%- side_column { -%>
    <div>TODO: OpenIDログインフォームを追加</div>
    <div>TODO: メールログインフォームを追加</div>
  <%- } -%>
<%- end -%>

<%- unless logged_in? -%>
  <div id="login_form">
    <div id="open_id_login_form">
      <%- form_tag(:controller => "auth/open_id", :action => "login") { -%>
        <div>
          <%= label_tag(:openid_url, "OpenID URL") %>
          <%= text_field_tag(:openid_url, '', :size => 50) %>
          <%= submit_tag("ログイン") %>
        </div>
      <%- } -%>
    </div>
    <div><%= link_to(h("メールアドレスによるログイン"), :controller => "auth/email") %></div>
    <div><%= link_to(h("メールアドレスによるサインアップ"), :controller => "signup/email") %></div>
  </div>
<%- end -%>

<%- if logged_in? -%>
  <h1>ダッシュボード</h1>
  <%= render(:partial => "devices")  %>

  <div>
    <div style="float: left;">
      <h2>エネルギー履歴</h2>
      <%= render(:partial => "energies") %>
    </div>
    <div style="float: left;">
      <h2>イベント履歴</h2>
      <%= render(:partial => "events") %>
      <div>
        [ <%= link_to(feed_icon + h(" RSS"), :controller => "user_feeds", :action => "events", :user_token => @login_user.user_token) %>
        | <%= link_to(h("すべて"), :controller => "events") %> (<%=h @events.total_entries %>) ]
      </div>
    </div>
    <div style="clear: both;"></div>
  </div>
<%- end -%>
